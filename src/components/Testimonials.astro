---
interface Testimonial {
  name: string;
  initials: string;
  role: string;
  rating: number;
  review: string;
  product?: string;
  date: string;
}

interface Props {
  title?: string;
  subtitle?: string;
  showSchema?: boolean;
}

const {
  title = "What Healthcare Professionals Say",
  subtitle = "Real reviews from nurses and medical staff who use our products every day",
  showSchema = true
} = Astro.props;

const testimonials: Testimonial[] = [
  {
    name: "Sarah R.",
    initials: "SR",
    role: "RN, Emergency Department",
    rating: 5,
    review: "Finally, gear that actually works for nurses! The magnetic stethoscope holder is a game-changer for my 12-hour shifts. No more neck pain from wearing my stethoscope around my neck all day.",
    product: "Magnetic Stethoscope Holder",
    date: "2026-01-15"
  },
  {
    name: "Michael T.",
    initials: "MT",
    role: "RN, ICU",
    rating: 5,
    review: "I was skeptical at first, but this holder is incredibly secure. I've been using it for 3 months now and it hasn't budged once during codes or rapid responses. Highly recommend!",
    product: "Magnetic Stethoscope Holder",
    date: "2026-01-10"
  },
  {
    name: "Jessica L.",
    initials: "JL",
    role: "LVN, Med-Surg",
    rating: 5,
    review: "The fanny pack is perfect for keeping all my supplies organized. Pens, scissors, alcohol swabs - everything has a place. My coworkers keep asking where I got it!",
    product: "Nurse Fanny Pack",
    date: "2026-01-05"
  },
  {
    name: "David K.",
    initials: "DK",
    role: "Paramedic",
    rating: 5,
    review: "As a paramedic, I need gear that can handle anything. This stethoscope holder stays put even during the most chaotic calls. Worth every penny.",
    product: "Magnetic Stethoscope Holder",
    date: "2025-12-28"
  },
  {
    name: "Amanda W.",
    initials: "AW",
    role: "RN, Labor & Delivery",
    rating: 5,
    review: "Love the quality and the cute design options! It's nice to have something functional that also shows a bit of personality. Great customer service too.",
    product: "Magnetic Stethoscope Holder",
    date: "2025-12-20"
  },
  {
    name: "Robert M.",
    initials: "RM",
    role: "CNA, Long-Term Care",
    rating: 5,
    review: "Simple, effective, and affordable. The clip is strong and the holder is lightweight. I forget I'm even wearing it until I need my stethoscope.",
    product: "Stethoscope Holder Clip",
    date: "2025-12-15"
  }
];

// Generate Review schema for SEO
const reviewSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "Bobcat Medical",
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.9",
    "reviewCount": testimonials.length.toString(),
    "bestRating": "5",
    "worstRating": "1"
  },
  "review": testimonials.map(t => ({
    "@type": "Review",
    "reviewRating": {
      "@type": "Rating",
      "ratingValue": t.rating.toString(),
      "bestRating": "5"
    },
    "author": {
      "@type": "Person",
      "name": t.name
    },
    "datePublished": t.date,
    "reviewBody": t.review,
    ...(t.product && { "itemReviewed": { "@type": "Product", "name": t.product } })
  }))
};

function renderStars(rating: number) {
  return Array(5).fill(0).map((_, i) => i < rating ? 'filled' : 'empty');
}
---

{showSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(reviewSchema)} />
)}

<section class="section-padding bg-warm-50">
  <div class="container-width">
    <div class="text-center mb-12">
      <span class="text-bobcat-600 font-semibold text-sm uppercase tracking-wide mb-2 block">Customer Reviews</span>
      <h2 class="font-display text-3xl md:text-4xl font-bold text-warm-900 mb-4">
        {title}
      </h2>
      <p class="text-warm-600 max-w-2xl mx-auto">
        {subtitle}
      </p>
      <!-- Aggregate Rating -->
      <div class="flex items-center justify-center gap-2 mt-4">
        <div class="flex gap-0.5">
          {[1,2,3,4,5].map(() => (
            <svg class="w-5 h-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
            </svg>
          ))}
        </div>
        <span class="font-semibold text-warm-900">4.9</span>
        <span class="text-warm-500">from {testimonials.length}+ reviews</span>
      </div>
    </div>

    <!-- Testimonial Grid -->
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
      {testimonials.map((testimonial) => (
        <div class="bg-white rounded-2xl p-6 shadow-sm hover:shadow-md transition-shadow">
          <!-- Stars -->
          <div class="flex gap-0.5 mb-4">
            {renderStars(testimonial.rating).map((star) => (
              <svg class={`w-5 h-5 ${star === 'filled' ? 'text-yellow-400' : 'text-warm-200'}`} fill="currentColor" viewBox="0 0 20 20">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            ))}
          </div>

          <!-- Review Text -->
          <p class="text-warm-700 mb-4 leading-relaxed">
            "{testimonial.review}"
          </p>

          <!-- Product Badge -->
          {testimonial.product && (
            <div class="mb-4">
              <span class="inline-block bg-bobcat-50 text-bobcat-700 text-xs font-medium px-2.5 py-1 rounded-full">
                {testimonial.product}
              </span>
            </div>
          )}

          <!-- Author -->
          <div class="flex items-center gap-3 pt-4 border-t border-warm-100">
            <div class="w-10 h-10 bg-bobcat-100 rounded-full flex items-center justify-center">
              <span class="text-bobcat-700 font-bold text-sm">{testimonial.initials}</span>
            </div>
            <div>
              <div class="font-semibold text-warm-900 text-sm">{testimonial.name}</div>
              <div class="text-warm-500 text-xs">{testimonial.role}</div>
            </div>
          </div>
        </div>
      ))}
    </div>

    <!-- CTA -->
    <div class="text-center mt-12">
      <a href="/shop" class="btn-primary inline-flex items-center gap-2">
        Shop Best Sellers
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
        </svg>
      </a>
    </div>
  </div>
</section>
